<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± */
        .sidebar {
            width: 320px;
            background-color: #2c3e50;
            color: white;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid #3498db;
        }

        .sidebar-header h2 {
            text-align: center;
            margin-bottom: 15px;
        }

        .status-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .status-tab {
            flex: 1;
            min-width: 100px;
            background-color: #34495e;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            text-align: center;
            transition: all 0.3s ease;
        }

        .status-tab:hover {
            background-color: #3d566e;
        }

        .status-tab.active {
            background-color: #3498db;
            font-weight: bold;
        }

        .book-list {
            list-style: none;
            padding: 10px;
        }

        .book-item {
            background-color: #34495e;
            margin-bottom: 8px;
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 4px solid transparent;
        }

        .book-item:hover {
            background-color: #3d566e;
            transform: translateX(-3px);
        }

        .book-item.active {
            background-color: #3498db;
            border-right-color: #1abc9c;
        }

        .book-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .book-meta {
            font-size: 0.8em;
            color: #bdc3c7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Ù…Ø­ØªÙˆØ§ */
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.5em;
        }

        .controls {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }
.tab-count {
    font-size: 0.85em;
    background-color: rgba(255, 255, 255, 0.2);
    padding: 2px 6px;
    border-radius: 10px;
    margin-right: 5px;
}
        /* ÙØ±Ù… */
        .book-form {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95em;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .form-control[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        textarea.form-control {
            min-height: 80px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .text-control {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.4;
        }

        /* ØµÙØ­Ø§Øª */
        .pages-section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .pages-section h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1.2em;
        }

        .page-item {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .page-number {
            background-color: #3498db;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-edited {
            background-color: #d4edda;
            color: #155724;
        }

        .status-not-edited {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-temp {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-final {
            background-color: #cce5ff;
            color: #004085;
        }

        /* ÙˆØ¶Ø¹ÛŒØª */
        .status-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .status-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            font-size: 0.9em;
        }

        /* Ù…Ø¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid #dee2e6;
        }

        /* Ù¾ÛŒØ§Ù… */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .message.show {
            opacity: 1;
        }

        .message.success {
            background-color: #2ecc71;
        }

        .message.error {
            background-color: #e74c3c;
        }

        /* Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .hidden {
            display: none;
        }

        /* Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù¾ÛŒ */
        .copy-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .copy-tool-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.3s;
        }

        .copy-tool-btn:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ“š Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</h2>
<div class="status-tabs">
    <button class="status-tab active" data-status="all">
        Ù‡Ù…Ù‡ <span class="tab-count" id="count-all">(0)</span>
    </button>
    <button class="status-tab" data-status="Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡">
        Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡ <span class="tab-count" id="count-final">(0)</span>
    </button>
    <button class="status-tab" data-status="ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª">
        ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª <span class="tab-count" id="count-temp">(0)</span>
    </button>
    <button class="status-tab" data-status="ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡">
        ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡ <span class="tab-count" id="count-not-edited">(0)</span>
    </button>
</div>
            </div>
            <ul id="bookList" class="book-list">
                <!-- Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </ul>
        </div>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="content">
            <div class="header">
                <h1 id="pageTitle">Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</h1>
                <div class="controls">
                    <button class="btn btn-primary" onclick="downloadFile('information.json')">
                        ğŸ“¥ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                    </button>
                    <button class="btn btn-primary" onclick="downloadFile('text.json')">
                        ğŸ“¥ Ù…ØªÙ†â€ŒÙ‡Ø§
                    </button>
                    <button class="btn btn-success" onclick="saveChanges()">
                        ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡
                    </button>
                </div>
            </div>

            <!-- ÙØ±Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨ -->
            <div id="bookForm" class="book-form hidden">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø´Ù†Ø§Ø³Ù‡ (Slug):</label>
                        <input type="text" id="slug" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ú©ØªØ§Ø¨:</label>
                        <input type="text" id="name" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡:</label>
                    <textarea id="shortDesc" class="form-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:</label>
                    <textarea id="aboutAuthor" class="form-control text-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©ØªØ§Ø¨:</label>
                    <textarea id="aboutBook" class="form-control text-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ù†Ù‚Ø¯ Ú©ØªØ§Ø¨:</label>
                    <textarea id="bookReview" class="form-control text-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ØªØ§Ø¨:</label>
                    <textarea id="descBook" class="form-control text-control"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ú†Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯:</label>
                    <textarea id="whoShouldRead" class="form-control text-control"></textarea>
                </div>
                
                <!-- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù¾ÛŒ -->
                <div class="copy-tools">
                    <button class="copy-tool-btn" onclick="copyBookInfo()">
                        ğŸ“‹ Ú©Ù¾ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨
                    </button>
                    <button class="copy-tool-btn" onclick="copyBookText()">
                        ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ† Ú©ØªØ§Ø¨
                    </button>
                    <button class="btn btn-info btn-sm" onclick="openInfoJsonModal()">
                        â• Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="openTextJsonModal()">
                        â• Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ù…ØªÙ†
                    </button>
                </div>
                
                <div class="status-section">
                    <label>ÙˆØ¶Ø¹ÛŒØª:</label>
                    <select id="status" class="status-select">
                        <option value="ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡">ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡</option>
                        <option value="ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª">ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª</option>
                        <option value="Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡">Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡</option>
                    </select>
                    <div id="statusBadge" class="status-badge status-not-edited">
                        ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø§Øª Ú©ØªØ§Ø¨ -->
            <div id="pagesSection" class="pages-section hidden">
                <h3>ğŸ“„ ØµÙØ­Ø§Øª Ú©ØªØ§Ø¨</h3>
                <div id="pagesContainer">
                    <!-- ØµÙØ­Ø§Øª Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </div>
            </div>

            <!-- Ø­Ø§Ù„Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ -->
            <div id="loading" class="loading">
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§...</p>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª -->
    <div id="infoJsonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨</h3>
                <button class="modal-close" onclick="closeInfoJsonModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ù…Ø­ØªÙˆÛŒØ§Øª Ø¬ÛŒØ³ÙˆÙ†:</label>
                    <textarea id="infoJsonInput" class="form-control" rows="15" 
            placeholder='{
  "slug": "book-slug", // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ - Ø§Ø¹Ù…Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
  "name": "Ù†Ø§Ù… Ú©ØªØ§Ø¨",
  "short_desc": "ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡",
  "about_the_author": "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡",
  "about_the_book": "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©ØªØ§Ø¨",
  "book_review": "Ù†Ù‚Ø¯ Ú©ØªØ§Ø¨",
  "desc_book": "ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ØªØ§Ø¨",
  "who_should_read": "Ú†Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯"
  // status Ø§ÛŒÙ†Ø¬Ø§ Ù†Ø¨Ø§Ø´Ø¯
}'></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeInfoJsonModal()">Ù„ØºÙˆ</button>
                <button class="btn btn-success" onclick="applyInfoJson()">Ø§Ø¹Ù…Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´</button>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ù…ØªÙ† -->
    <div id="textJsonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÛŒØ³ÙˆÙ† Ù…ØªÙ† Ú©ØªØ§Ø¨</h3>
                <button class="modal-close" onclick="closeTextJsonModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ù…Ø­ØªÙˆÛŒØ§Øª Ø¬ÛŒØ³ÙˆÙ† (Ø¢Ø±Ø§ÛŒÙ‡ ØµÙØ­Ø§Øª):</label>
                    <textarea id="textJsonInput" class="form-control" rows="15" 
                              placeholder='[
  {
    "title": "Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡ Û±",
    "content": "Ù…Ø­ØªÙˆØ§ ØµÙØ­Ù‡ Û±"
  },
  {
    "title": "Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡ Û²",
    "content": "Ù…Ø­ØªÙˆØ§ ØµÙØ­Ù‡ Û²"
  }
]'></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeTextJsonModal()">Ù„ØºÙˆ</button>
                <button class="btn btn-success" onclick="applyTextJson()">Ø§Ø¹Ù…Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´</button>
            </div>
        </div>
    </div>

    <!-- Ù¾ÛŒØ§Ù… -->
    <div id="message" class="message"></div>

    <script>
        let currentBook = null;
        let booksData = [];
        let filteredBooks = [];
        let currentFilter = 'all';

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener('DOMContentLoaded', function() {
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§
    document.querySelectorAll('.status-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const status = this.getAttribute('data-status');
            filterBooks(status);
        });
    });
    
   
    
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
    loadBooks();
});
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
// âœ… Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù‡Ø± Ø¯Ùˆ ØªØ§Ø¨Ø¹ loadBooks Ú©Ù†ÛŒØ¯
async function loadBooks() {
    try {
        booksData = await window.api.getBooks();
        
        if (!Array.isArray(booksData)) {
            booksData = [];
        }
        
        
        // Ø§ÙˆÙ„ ØªØ¹Ø¯Ø§Ø¯ ØªØ¨â€ŒÙ‡Ø§ Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
        updateTabCounts(booksData);
        
        // Ø³Ù¾Ø³ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
        filterBooks('all');
        
        document.getElementById('loading').classList.add('hidden');
        
    } catch (error) {
        showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§: ' + error.message, 'error');
        console.error('Load books error:', error);
    }
}
// ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
function filterBooks(status) {
    
    currentFilter = status;
    
    // Ø¢Ù¾Ø¯ÛŒØª ØªØ¨â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
    document.querySelectorAll('.status-tab').forEach((tab, index) => {
        tab.classList.remove('active');
        if (status === 'all' && index === 0) {
            tab.classList.add('active');
        } else if (tab.textContent.includes(status)) {
            tab.classList.add('active');
        }
    });
    
    if (status === 'all') {
        filteredBooks = [...booksData];
    } else {
        filteredBooks = booksData.filter(book => book.status === status);
    }
    
    displayBooks(filteredBooks);
}


        // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
        function displayBooks(books) {
            const bookList = document.getElementById('bookList');
            bookList.innerHTML = '';

            if (books.length === 0) {
                bookList.innerHTML = '<div class="loading">Ú©ØªØ§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }

            books.forEach(book => {
                const li = document.createElement('li');
                li.className = 'book-item';
                li.onclick = () => selectBook(book.slug);
                
                li.innerHTML = `
                    <div class="book-title">${book.name || 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…'}</div>
                    <div class="book-meta">
                        <span>${book.pages_count || 0} ØµÙØ­Ù‡</span>
                        <span class="status-badge ${getStatusClass(book.status)}">
                            ${book.status}
                        </span>
                    </div>
                `;
                
                bookList.appendChild(li);
            });
        }

        // Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
        function getStatusClass(status) {
            switch(status) {
                case 'Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡': return 'status-final';
                case 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª': return 'status-temp';
                case 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡': return 'status-edited';
                default: return 'status-not-edited';
            }
        }




async function selectBook(slug) {
    try {
        // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        document.querySelectorAll('.book-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ… Ù…Ø±Ø¨ÙˆØ·Ù‡
        const items = document.querySelectorAll('.book-item');
        for (let item of items) {
            if (item.querySelector('.book-title').textContent === 
                booksData.find(b => b.slug === slug)?.name) {
                item.classList.add('active');
                break;
            }
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨
        currentBook = await window.api.getBook(slug);
        displayBookDetails(currentBook);
    } catch (error) {
        showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨: ' + error.message, 'error');
    }
}

        // Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©ØªØ§Ø¨
        function displayBookDetails(book) {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡
            document.getElementById('pageTitle').textContent = book.data?.name || 'Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨';
            
            // Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù…
            const form = document.getElementById('bookForm');
            form.classList.remove('hidden');
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ±Ù…
            document.getElementById('slug').value = book.slug;
            document.getElementById('name').value = book.data?.name || '';
            document.getElementById('shortDesc').value = book.data?.short_desc || '';
            document.getElementById('aboutAuthor').value = book.data?.about_the_author || '';
            document.getElementById('aboutBook').value = book.data?.about_the_book || '';
            document.getElementById('bookReview').value = book.data?.book_review || '';
            document.getElementById('descBook').value = book.data?.desc_book || '';
            document.getElementById('whoShouldRead').value = book.data?.who_should_read || '';
            document.getElementById('status').value = book.status || 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø´Ø§Ù† ÙˆØ¶Ø¹ÛŒØª
            updateStatusBadge(book.status);
            
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª
            displayPages(book.pages);
        }

        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª Ú©ØªØ§Ø¨
        function displayPages(pages) {
            const pagesSection = document.getElementById('pagesSection');
            const container = document.getElementById('pagesContainer');
            
            pagesSection.classList.remove('hidden');
            container.innerHTML = '';

            if (pages.length === 0) {
                container.innerHTML = '<p class="loading">Ø§ÛŒÙ† Ú©ØªØ§Ø¨ Ù‡ÛŒÚ† ØµÙØ­Ù‡â€ŒØ§ÛŒ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                return;
            }

            pages.forEach((page, index) => {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page-item';
                pageDiv.innerHTML = `
                    <div class="page-header">
                        <div class="page-number">ØµÙØ­Ù‡ ${index + 1}</div>
                    </div>
                    <div class="form-group">
                        <label>Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡:</label>
                        <input type="text" 
                               class="form-control page-title" 
                               data-index="${index}"
                               value="${page.title || ''}"
                               oninput="markPageChanged(${index}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Ù…Ø­ØªÙˆØ§:</label>
                        <textarea class="form-control page-content text-control" 
                                  data-index="${index}"
                                  rows="6"
                                  oninput="markPageChanged(${index}, 'content', this.value)">${page.content || ''}</textarea>
                    </div>
                `;
                container.appendChild(pageDiv);
            });
        }

        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª
        document.getElementById('status').addEventListener('change', function() {
            if (currentBook) {
                currentBook.status = this.value;
                updateStatusBadge(this.value);
            }
        });

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø´Ø§Ù† ÙˆØ¶Ø¹ÛŒØª
        function updateStatusBadge(status) {
            const badge = document.getElementById('statusBadge');
            badge.textContent = status;
            badge.className = `status-badge ${getStatusClass(status)}`;
        }

        // ØµÙØ­Ø§Øª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡
        const changedPages = new Map();

        function markPageChanged(index, field, value) {
            if (!currentBook) return;
            
            const pageKey = `${currentBook.slug}-${index}`;
            if (!changedPages.has(pageKey)) {
                changedPages.set(pageKey, { index, changes: {} });
            }
            
            const page = changedPages.get(pageKey);
            page.changes[field] = value;
        }

function copyBookInfo() {
    if (!currentBook) {
        showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©ØªØ§Ø¨ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
        return;
    }

    const bookInfo = {
        name: document.getElementById('name').value,
        short_desc: document.getElementById('shortDesc').value,
        about_the_author: document.getElementById('aboutAuthor').value,
        about_the_book: document.getElementById('aboutBook').value,
        book_review: document.getElementById('bookReview').value,
        desc_book: document.getElementById('descBook').value,
        who_should_read: document.getElementById('whoShouldRead').value,
    };

    const prefixText = `
ØªÙˆ ÛŒÚ© Ù…ØªØ±Ø¬Ù… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©ØªØ§Ø¨ Ù‡Ø³ØªÛŒ.
Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒ ÙØ§ÛŒÙ„ Ø¬ÛŒØ³ÙˆÙ† Ø§Ø³Øª 
Ùˆ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ù…ÛŒØ®ÙˆØ§Ù‡Ù… Ø¨Ø§ ÙØ±Ù…Øª Ø¬ÛŒØ³ÙˆÙ† 

Ù…ØªÙ† Ø²ÛŒØ± Ø±Ø§ Ø§Ø² Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ØªØ±Ø¬Ù…Ù‡ Ú©Ù† Ø¨Ù‡ Ø´Ú©Ù„ÛŒ Ú©Ù‡:
- Ú©Ø§Ù…Ù„Ø§Ù‹ Ø±ÙˆØ§Ù† Ùˆ Ø·Ø¨ÛŒØ¹ÛŒ Ùˆ Ù¾ÛŒÙˆØ³ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Ù…ØªÙ† Ø®Ù„Ø§ØµÙ‡ Ø³Ø§Ø²ÛŒ Ù†Ø´ÙˆØ¯
- Ø§Ø² Ø®Ù„Ø§Ù‚ÛŒØª Ø¬Ù‡Øª Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ØªØ± Ù…ÙÙ‡ÙˆÙ… Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
-Ù…Ù‡Ù… ØªØ±ÛŒÙ† Ú†ÛŒØ² Ù„Ø­Ù† Ù…Ø­Ø§ÙˆØ±Ù‡ Ø§ÛŒ Ú©ØªØ§Ø¨ Ø§Ø³Øª Ú©Ù‡ Ù…Ø«Ù„ ÛŒÚ© Ø¯ÙˆØ³Øª Ø¨Ø§Ø§Ø¯Ø¨ Ù…ÛŒÙ†ÙˆÛŒØ³Ø¯
- ØªØ±Ø¬Ù…Ù‡ ØªØ­Øªâ€ŒØ§Ù„Ù„ÙØ¸ÛŒ Ù†Ø¨Ø§Ø´Ø¯
- Ù…Ø¹Ø§Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…ÙÙ‡ÙˆÙ…ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯
-Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ù…Ø¹Ø§Ø¯Ù„ Ø³Ø§Ø²ÛŒ Ú©Ù† 

Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ùˆ Ø¯Ø± Ù‚Ø§Ù„Ø¨ Ø¬ÛŒØ³ÙˆÙ† Ø¨Ø§Ø´Ø¯

`;

    const jsonString = JSON.stringify(bookInfo, null, 2);
    const finalText = prefixText + jsonString;

    navigator.clipboard.writeText(finalText)
        .then(() => showMessage('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨ Ùˆ Ù…ØªÙ† ØªØ±Ø¬Ù…Ù‡ Ø´Ø¯Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯', 'success'))
        .catch(() => showMessage('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†', 'error'));
}


        // Ú©Ù¾ÛŒ Ù…ØªÙ† Ú©ØªØ§Ø¨
        function copyBookText() {
            if (!currentBook || !currentBook.pages || currentBook.pages.length === 0) {
                showMessage('Ø§ÛŒÙ† Ú©ØªØ§Ø¨ ØµÙØ­Ù‡â€ŒØ§ÛŒ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                return;
            }

            const pages = currentBook.pages.map(page => ({
                title: page.title || '',
                content: page.content || ''
            }));
    const prefixText = `
ØªÙˆ ÛŒÚ© Ù…ØªØ±Ø¬Ù… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©ØªØ§Ø¨ Ù‡Ø³ØªÛŒ.
Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒ ÙØ§ÛŒÙ„ Ø¬ÛŒØ³ÙˆÙ† Ø§Ø³Øª 
Ùˆ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ù…ÛŒØ®ÙˆØ§Ù‡Ù… Ø¨Ø§ ÙØ±Ù…Øª Ø¬ÛŒØ³ÙˆÙ† 

Ù…ØªÙ† Ø²ÛŒØ± Ø±Ø§ Ø§Ø² Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ØªØ±Ø¬Ù…Ù‡ Ú©Ù† Ø¨Ù‡ Ø´Ú©Ù„ÛŒ Ú©Ù‡:
- Ú©Ø§Ù…Ù„Ø§Ù‹ Ø±ÙˆØ§Ù† Ùˆ Ø·Ø¨ÛŒØ¹ÛŒ Ùˆ Ù¾ÛŒÙˆØ³ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Ù…ØªÙ† Ø®Ù„Ø§ØµÙ‡ Ø³Ø§Ø²ÛŒ Ù†Ø´ÙˆØ¯
- Ø§Ø² Ø®Ù„Ø§Ù‚ÛŒØª Ø¬Ù‡Øª Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ØªØ± Ù…ÙÙ‡ÙˆÙ… Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
-Ù…Ù‡Ù… ØªØ±ÛŒÙ† Ú†ÛŒØ² Ù„Ø­Ù† Ù…Ø­Ø§ÙˆØ±Ù‡ Ø§ÛŒ Ú©ØªØ§Ø¨ Ø§Ø³Øª Ú©Ù‡ Ù…Ø«Ù„ ÛŒÚ© Ø¯ÙˆØ³Øª Ø¨Ø§Ø§Ø¯Ø¨ Ù…ÛŒÙ†ÙˆÛŒØ³Ø¯
- ØªØ±Ø¬Ù…Ù‡ ØªØ­Øªâ€ŒØ§Ù„Ù„ÙØ¸ÛŒ Ù†Ø¨Ø§Ø´Ø¯
- Ù…Ø¹Ø§Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…ÙÙ‡ÙˆÙ…ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯
- Ù…Ù†Ø¸ÙˆØ± Ø§Ø² Blink Ø®Ù„Ø§ØµÙ‡ Ø§Ø³Øª
-Ø§Ø³Ø§Ù…ÛŒ Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ù…Ø¹Ø§Ø¯Ù„ Ø³Ø§Ø²ÛŒ Ú©Ù† 

Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ùˆ Ø¯Ø± Ù‚Ø§Ù„Ø¨ Ø¬ÛŒØ³ÙˆÙ† Ø¨Ø§Ø´Ø¯

â€â€â€`
            const jsonString = JSON.stringify(pages, null, 2);
            const prompt =prefixText+ jsonString 
            navigator.clipboard.writeText(prompt)
                .then(() => showMessage('Ù…ØªÙ† Ú©ØªØ§Ø¨ Ú©Ù¾ÛŒ Ø´Ø¯', 'success'))
                .catch(() => showMessage('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†', 'error'));
        }

        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¯Ø§Ù„ Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        function openInfoJsonModal() {
            if (!currentBook) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©ØªØ§Ø¨ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            // Ù¾Ø± Ú©Ø±Ø¯Ù† slug Ø¯Ø± Ù†Ù…ÙˆÙ†Ù‡ JSON
            const sampleJson = {
                slug: currentBook.slug,
                name: document.getElementById('name').value,
                short_desc: document.getElementById('shortDesc').value,
                about_the_author: document.getElementById('aboutAuthor').value,
                about_the_book: document.getElementById('aboutBook').value,
                book_review: document.getElementById('bookReview').value,
                desc_book: document.getElementById('descBook').value,
                who_should_read: document.getElementById('whoShouldRead').value,
                status: currentBook.status
            };

            document.getElementById('infoJsonInput').value = JSON.stringify(sampleJson, null, 2);
            document.getElementById('infoJsonModal').classList.add('active');
        }

        // Ø¨Ø³ØªÙ† Ù…Ø¯Ø§Ù„ Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        function closeInfoJsonModal() {
            document.getElementById('infoJsonModal').classList.remove('active');
        }

        // Ø§Ø¹Ù…Ø§Ù„ Ø¬ÛŒØ³ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª
async function applyInfoJson() {
    try {
        const jsonText = document.getElementById('infoJsonInput').value;
        const jsonData = JSON.parse(jsonText);

        // slug Ø±Ø§ Ø§Ø² Ú©ØªØ§Ø¨ ÙØ¹Ù„ÛŒ Ø¨Ú¯ÛŒØ±ØŒ Ù†Ù‡ Ø§Ø² JSON
        const currentSlug = currentBook.slug;
        
        // Ø­Ø°Ù slug Ùˆ status Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯
        delete jsonData.slug;
        delete jsonData.status;

        // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ API Ø¨Ø§ slug Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
        await window.api.addInfoJson(currentSlug, jsonData);
        
        closeInfoJsonModal();
        showMessage('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ØªØ§Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
        
        // Ø±ÙØ±Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        await loadBooks();
        await selectBook(currentSlug);
        
    } catch (error) {
        showMessage('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ JSON: ' + error.message, 'error');
    }
}
        function openTextJsonModal() {
            if (!currentBook) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©ØªØ§Ø¨ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ø§Øª ÙØ¹Ù„ÛŒ Ø¯Ø± Ù†Ù…ÙˆÙ†Ù‡
            const samplePages = currentBook.pages.map(page => ({
                title: page.title || '',
                content: page.content || ''
            }));

            document.getElementById('textJsonInput').value = JSON.stringify(samplePages, null, 2);
            document.getElementById('textJsonModal').classList.add('active');
        }

        // Ø¨Ø³ØªÙ† Ù…Ø¯Ø§Ù„ Ø¬ÛŒØ³ÙˆÙ† Ù…ØªÙ†
        function closeTextJsonModal() {
            document.getElementById('textJsonModal').classList.remove('active');
        }

        // Ø§Ø¹Ù…Ø§Ù„ Ø¬ÛŒØ³ÙˆÙ† Ù…ØªÙ†
        async function applyTextJson() {
            try {
                const jsonText = document.getElementById('textJsonInput').value;
                const pages = JSON.parse(jsonText);

                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                if (!Array.isArray(pages)) {
                    showMessage('Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯', 'error');
                    return;
                }

                // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ API
                await window.api.addTextJson(currentBook.slug, pages);
                
                closeTextJsonModal();
                showMessage('Ù…ØªÙ† Ú©ØªØ§Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
                
                // Ø±ÙØ±Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                await loadBooks();
                await selectBook(currentBook.slug);
                
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ JSON: ' + error.message, 'error');
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
        async function saveChanges() {
            if (!currentBook) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©ØªØ§Ø¨ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            try {
                // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                const changedData = {};
                const name = document.getElementById('name').value;
                const shortDesc = document.getElementById('shortDesc').value;
                const aboutAuthor = document.getElementById('aboutAuthor').value;
                const aboutBook = document.getElementById('aboutBook').value;
                const bookReview = document.getElementById('bookReview').value;
                const descBook = document.getElementById('descBook').value;
                const whoShouldRead = document.getElementById('whoShouldRead').value;
                
                if (name !== currentBook.data?.name) changedData.name = name;
                if (shortDesc !== currentBook.data?.short_desc) changedData.short_desc = shortDesc;
                if (aboutAuthor !== currentBook.data?.about_the_author) changedData.about_the_author = aboutAuthor;
                if (aboutBook !== currentBook.data?.about_the_book) changedData.about_the_book = aboutBook;
                if (bookReview !== currentBook.data?.book_review) changedData.book_review = bookReview;
                if (descBook !== currentBook.data?.desc_book) changedData.desc_book = descBook;
                if (whoShouldRead !== currentBook.data?.who_should_read) changedData.who_should_read = whoShouldRead;

                // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªØºÛŒÛŒØ±Ø§Øª ØµÙØ­Ø§Øª
                const pagesChanges = [];
                changedPages.forEach((page, key) => {
                    if (key.startsWith(currentBook.slug)) {
                        pagesChanges.push({
                            index: page.index,
                            ...page.changes
                        });
                    }
                });

                // Ø§Ø±Ø³Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡
                await window.api.saveBook({
                    slug: currentBook.slug,
                    changedData,
                    changedPages: pagesChanges,
                    status: currentBook.status
                });

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
                changedPages.clear();

                showMessage('ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                
                // Ø±ÙØ±Ø´ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
                await loadBooks();
                                        updateTabCounts(booksData);

            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: ' + error.message, 'error');
            }
        }

        // Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        async function downloadFile(filename) {
            try {
                const result = await window.api.downloadFile(filename);
                if (result.success) {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯
                    const blob = new Blob([result.content], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showMessage(`ÙØ§ÛŒÙ„ ${filename} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯`, 'success');
                }
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯: ' + error.message, 'error');
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type} show`;
            
            setTimeout(() => {
                messageDiv.classList.remove('show');
            }, 3000);
        }
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¯Ø± ØªØ¨â€ŒÙ‡Ø§
// Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¯Ø± ØªØ¨â€ŒÙ‡Ø§
function updateTabCounts() {
    
    if (!Array.isArray(booksData)) {
        booksData = [];
    }
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ - Ø¨Ø§ Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
    const allCount = booksData.length;
    const finalCount = booksData.filter(b => b.status === 'Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡').length;
    const tempCount = booksData.filter(b => b.status === 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª').length;
    const notEditedCount = booksData.filter(b => 
        !b.status || 
        b.status === 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø´Ø¯Ù‡' || 
        b.status === ''
    ).length;
    

    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ø± DOM
    const countAll = document.getElementById('count-all');
    const countFinal = document.getElementById('count-final');
    const countTemp = document.getElementById('count-temp');
    const countNotEdited = document.getElementById('count-not-edited');
    
    if (countAll) countAll.textContent = `(${allCount})`;
    if (countFinal) countFinal.textContent = `(${finalCount})`;
    if (countTemp) countTemp.textContent = `(${tempCount})`;
    if (countNotEdited) countNotEdited.textContent = `(${notEditedCount})`;
    
    
}
    </script>
</body>
</html>